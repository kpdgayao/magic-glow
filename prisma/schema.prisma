generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum LanguagePref {
  ENGLISH
  TAGLISH
}

enum FinancialGoal {
  SAVE_EMERGENCY_FUND
  PAY_OFF_DEBT
  START_INVESTING
  BUDGET_BETTER
  GROW_CREATOR_INCOME
}

enum QuizResult {
  YOLO
  CHILL
  PLAN
  MASTER
}

enum ChatRole {
  USER
  ASSISTANT
}

enum ExpenseCategory {
  NEEDS
  WANTS
  SAVINGS
}

enum EmploymentStatus {
  FULL_TIME_CREATOR
  STUDENT
  PART_TIME_PLUS_CREATOR
  EMPLOYED_PLUS_SIDE_HUSTLE
}

enum EmergencyFundStatus {
  YES
  NO
  BUILDING
}

enum DebtSituation {
  NONE
  STUDENT_LOAN
  CREDIT_CARD
  INFORMAL_DEBT
}

model User {
  id            String        @id @default(cuid())
  email         String        @unique
  name          String?
  age           Int?
  incomeSources String[]
  monthlyIncome Float?
  financialGoal FinancialGoal?
  languagePref  LanguagePref  @default(ENGLISH)
  quizResult        QuizResult?
  quizChallenge     String?
  employmentStatus  EmploymentStatus?
  hasEmergencyFund  EmergencyFundStatus?
  debtSituation     DebtSituation?
  isAdmin           Boolean       @default(false)
  onboarded         Boolean       @default(false)
  streakCount   Int           @default(0)
  lastCheckIn   DateTime?
  longestStreak Int           @default(0)
  xp            Int           @default(0)
  level         Int           @default(1)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  chatMessages    ChatMessage[]
  incomeEntries   IncomeEntry[]
  budgetSnapshots BudgetSnapshot[]
  magicLinks      MagicLink[]
  dailyAdvice     DailyAdvice[]
  expenses        Expense[]
  monthlyBudgets  MonthlyBudget[]
}

model MagicLink {
  id        String    @id @default(cuid())
  token     String    @unique
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())

  @@index([token])
}

model ChatMessage {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  role      ChatRole
  content   String
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

model IncomeEntry {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  source    String
  type      String
  amount    Float
  date      DateTime
  note      String?
  createdAt DateTime @default(now())

  @@index([userId, date])
}

model BudgetSnapshot {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  income    Float
  needs     Float
  wants     Float
  savings   Float
  createdAt DateTime @default(now())

  @@index([userId, createdAt])
}

model DailyAdvice {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  content   String
  date      DateTime @db.Date
  createdAt DateTime @default(now())

  @@unique([userId, date])
  @@index([userId, date])
}

model Expense {
  id          String          @id @default(cuid())
  userId      String
  user        User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  category    ExpenseCategory
  subcategory String
  amount      Float
  note        String?
  date        DateTime
  createdAt   DateTime        @default(now())

  @@index([userId, date])
  @@index([userId, category])
}

model MonthlyBudget {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  month     Int
  year      Int
  income    Float
  needs     Float
  wants     Float
  savings   Float
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, month, year])
  @@index([userId, year, month])
}
